%% Collision Detection Stuff::

% I'll write functions to call during the exsection to see if there are
% collsion detections in place
%
% If there is an intersection == stop robot
% Always be checking, will be on a constant loop









%% FROM WEEK 5 LAB SOLUTION



% Check each of the cone end rays for intersection with a UFO
function ufoHitIndex = CheckIntersections(endEffectorTr,coneEnds,ufoFleet)
ufoHitIndex = [];
for rayIndex = 1:size(coneEnds,1)
    for ufoIndex = 1:size(ufoFleet.model,2)
        % Ray from this part of the cone
        rayStart = endEffectorTr(1:3,4)';
        rayEnd = coneEnds(rayIndex,:);
        
        % Disk representing the UFO
        ufoPoint = ufoFleet.model{ufoIndex}.base(1:3,4)';
        ufoNormal = ufoFleet.model{ufoIndex}.base(3,1:3);

        % Check intersection of the line with the plane.
        [intersectionPoint,check] = LinePlaneIntersection(ufoNormal,ufoPoint,rayStart,rayEnd);
        % Check for an intersection which is also close to the ufoCenter
        if check ~= 1 || ufoFleet.shipRadius < DistanceBetweenTwoPoints(intersectionPoint,ufoPoint) 
            continue;
        end
        ufoHitIndex = [ufoHitIndex,ufoIndex];          %#ok<AGROW>
    end
end
end
